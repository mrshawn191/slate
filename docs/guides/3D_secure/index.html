<!doctype html>
<html>
  <head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W92MC5');</script>
<!-- End Google Tag Manager -->

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon-9dabc470.png">
<link rel="icon" type="image/png" href="/images/favicon/favicon-32x32-b71a5283.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon/favicon-16x16-ea515fe9.png" sizes="16x16">
<link rel="manifest" href="/images/favicon/manifest.json">
<link rel="mask-icon" href="/images/favicon/safari-pinned-tab-fb883d2e.svg" color="#8247b5 ">
<meta name="theme-color" content="#ffffff ">

<!-- Site version (latest commit): 9f6f881b08ad1b133002af56bc1342ed0c0a2958
 -->

<title>3D Secure</title>

<link href="../../../stylesheets/ui.bambora.1.0.3-13e3506d.css" rel="stylesheet" type="text/css" />
<link href="../../../stylesheets/bambora_ui_sass_overwrite-d859adf4.css" rel="stylesheet" type="text/css" />
<link href="../../../stylesheets/portal-5e95ed43.css" rel="stylesheet" type="text/css" />
<link href="../../../stylesheets/page/tutorial-c59b694d.css" rel="stylesheet" type="text/css" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
</script>

<script src="../../../javascripts/all-654c8dcb.js" type="text/javascript"></script>

  </head>

  <body class="docs docs_guides docs_guides_3D_secure docs_guides_3D_secure_index">

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-W92MC5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    

<nav class="nav-pane nav-fixed">

    <!-- Hamburger icon --> 
    <a href="#" class="hamburger-icon"><svg width="19" height="14" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><title>list</title><path d="M7.968 2.28h10.245V0H7.968v2.28zM0 7.975h18.213v-2.28H0v2.28zm0 5.696h10.245v-2.278H0v2.278z" fill="#84898A" fill-rule="evenodd"/></svg></a>

    <!-- Logo -->
    <div class="pull-left nav-links">
        <a href="/slate/docs/" class="logo">
                <img src="../../../images/svg/zebraffe-dark-dev-05ffe493.svg" />
        </a>
    </div>

    <div class="header-contents">

    <!-- Links --> 
    <div class="pull-left nav-links">
                <a href="/slate/docs/guides/" class="active">Guides</a>
                <a href="/slate/docs/references/">API</a>
                <a href="/slate/docs/support/">PSP Service Reference</a>
    </div>

    <!-- Search / buttons -->
    <div class="pull-right">
        
        <span class="button-wrap">
            <a id="search-button" href="#"><svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><title>search</title><path d="M5 0a5 5 0 1 0 3.164 8.87l5.13 5.13.706-.707-5.13-5.129A5 5 0 0 0 5 0m0 1c2.206 0 4 1.794 4 4 0 .934-.313 1.809-.904 2.53l-.254.312-.312.254A3.952 3.952 0 0 1 5 9C2.794 9 1 7.206 1 5s1.794-4 4-4" fill="#454545" fill-rule="evenodd"/></svg></a>
        </span>

            <span class="button-wrap">
                    <a href="/slate/docs/sign_up/" class="btn btn-small btn-secondary" >
                        Sign up
                    </a>
            </span>
            <span class="button-wrap">
                    <a href="https://web.na.bambora.com" class="btn btn-small" >
                        Login
                    </a>
            </span>

        <div class="dropdown-nav dropdown-open-on-hover" role="navigation" 
id="region-switcher">
    North America
    <ul role="menu">
        
        <li role="menuitem">
            <a href="https://developer.bambora.com/apac" class="not-new-tab-for-link">
                Asia-Pacific
            </a>
        </li>

        <li role="menuitem">
            <a href="https://developer.bambora.com/europe" class="not-new-tab-for-link">
                Europe
            </a>
        </li>
    </ul>
</div>
    </div>

    </div>
</nav>

<div id="search-overlay">
  <a href="#" id="close-search-overlay"><svg width="19" height="19" viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg"><title>close</title><path d="M1.608 0L0 1.61l7.498 7.505L0 16.62l1.608 1.61 7.498-7.505 7.498 7.505 1.608-1.61-7.498-7.505 7.499-7.505L16.604 0 9.106 7.507z" fill="#616668" fill-rule="evenodd"/></svg></a>

  <div class="container">

    <form>
      <div class="form-group">
        <input type="text" id="search" placeholder="Search..." width="100%", autocomplete="off" >
      </div>
    </form>

    <div id="result-count"></div>

    <div class="list-group">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <ul class="search-results"></ul>
        </div>
      </div>
    </div>

  </div>
</div>



    <div class="container">

      <a id="edit-on-github" href="https://github.com/bambora/dev.na.bambora.com/edit/staging/source/docs/guides/3D_secure.md">
  Edit this page
</a>


<!-- Modal apears on link click -->
<div class="modal-overlay">
  <div class="modal github-modal" role="dialog">
      <h3 class="js-toc-ignore">Edit on Github</h3>

      <p> 
      To propose changes to the Developer Portal click the link below and follow these steps: 
      </p>

      <ol>
        <li>Sign in to Github. You will have to create an account if you don't already have one.</li>
        <li>Click the <strong>Fork this repository and propose changes </strong>button.</li>
        <li>Make your proposed changes to the file. Content is formatted with <a href="http://commonmark.org/help/">Markdown.</a></li>
        <li>At the bottom of the page, optionally add a title and description to your changes, and click the <strong>Propose file change button</strong>.</li>
        <li>On the next page, click <strong>Create pull request</strong>, and then click it again.</li>
        <li>You're done! Someone will review your changes and they will appear on the site shortly.</li>
      </ol>

      <div class="btn-row">
          <a href="#" class="btn continue-to-github" target="_blank">Continue to Github</a>
          <button class="btn btn-secondary close-modal">Cancel</button>
      </div>
  </div>
</div>      
          <div class='breadcrumb-trail'><span><a href='/docs/'>Docs</a></span><span class='chevron'> / </span><span><a href='/docs/guides/'>Guides</a></span><span class='chevron'> / </span><span class='this-page'>3D Secure</span></div>
 
      
    


<div class="nav-wrapper">
<nav class="nav-left nav-sticky nav-vertical">

  <div class="mobile-close"><svg width="19" height="19" viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg"><title>close</title><path d="M1.608 0L0 1.61l7.498 7.505L0 16.62l1.608 1.61 7.498-7.505 7.498 7.505 1.608-1.61-7.498-7.505 7.499-7.505L16.604 0 9.106 7.507z" fill="#616668" fill-rule="evenodd"/></svg></div>


      <div class="page-only js-toc"></div> 
</nav>
</div>

<!-- button to click on small screen to show toc -->
<div class="show-toc">
  Contents
</div>





      <div class="row">
          <div class="col-md-9 col-md-offset-3 js-toc-content">

          <div class="markdown">
            <h1 id="3d-secure">3D Secure</h1>

<p>Verified by Visa (VbV), MasterCard SecureCode, and AMEX SafeKey are security features that prompt customers to enter a 
passcode when they pay by Visa, MasterCard, or AMEX. Merchants that want to integrate VbV, SecureCode, or SafeKey must 
have signed up for the service through their bank merchant account issuer. This service must also be enabled by our 
support team.</p>

<p>For assistance, you can send a message to Client Services or call 1-888-472-0811.</p>

<p>With a VbV, SecureCode, or SafeKey transaction, a customer is redirected to a bank portal to enter their secure pin 
number before a transaction is processed. The bank then returns an authentication response which must be forwarded to 
our API for a transaction to complete.</p>

<p>In addition to this guide feel free to check out our <a href="https://github.com/bambora/na-payment-apis-demo">Payment APIs Demo implementation</a> on GitHub.</p>

<!-- Use one of these two options to implement 3D Secure: -->

<h2 id="1-use-our-2-step-process">1. Use our 2-Step process</h2>

<p>Use our RESTful Payment APIs to initiate the Payment and to complete the transaction request. In this standard 
integration, the VbV, SecureCode, and SafeKey process requires two transaction requests.</p>

<p><strong>Step 1:</strong> Submit a payment request and process the first result.</p>

<p>The merchant’s processing script forwards the transaction details to our REST API. The request includes a special 
&#39;term_url&#39; variable. This term_url variable allows the merchant to specify the URL where the bank VbV or SC, or SafeKey 
response is returned, after the customer enters their PIN and it is verified on the bank portal.</p>
<pre class="highlight shell"><code>Definition
POST /v1/payments HTTP/1.1

Request
curl https://api.na.bambora.com/v1/payments <span class="se">\</span>
-H <span class="s2">"Authorization: Passcode MzAwMjAwNTc4OjRCYUQ4MkQ5MTk3YjRjYzRiNzBhMjIxOTExZUU5Zjcw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-d <span class="s1">'{
    "payment_method":"token",
    "order_number":"MyOrderId-01234",
    "amount":15.99,
    "token":{
        "code":"gt7-0f2f20dd-777e-487e-b688-940b526172cd",
        "name":"John Doe",
        "3d_secure":{
            "enabled":true
        }
    },
    "term_url": "https://my.merchantserver.com/redirect/3d-secure"
}'</span>

Response <span class="o">(</span>HTTP status code 302 redirect<span class="o">)</span>

<span class="o">{</span>
  <span class="s2">"merchant_data"</span>: <span class="s2">"2ccd7715-9e97-4f11-9fff36e6584e3200"</span>,
  <span class="s2">"contents"</span>: <span class="s2">"%3cHTML%3e%3cHEAD%3e%3c%2fHEAD%3e%3cBODY%3e%3cFORM+action%3d%22https%3a%2f%2fapi.na.bambora.com%2factiveMerchantEmulator%2fgateway.asp%22+method%3d%22POST%22+id%3d%22form1%22+name%3d%22form1%22%3e%3cINPUT+type%3d%22hidden%22+name%3d%22PaReq%22+value%3d%22TEST_paRaq%22%3e%3cinput+type%3d%22hidden%22+name%3d%22merchant_name%22+value%3d%22Seven+Sparrow+Inc.%22%3e%3cinput+type%3d%22hidden%22+name%3d%22trnDatetime%22+value%3d%222%2f23%2f2017+5%3a05%3a42+PM%22%3e%3cinput+type%3d%22hidden%22+name%3d%22trnAmount%22+value%3d%22100.00%22%3e%3cinput+type%3d%22hidden%22+name%3d%22trnEncCardNumber%22+value%3d%22XXXX+XXXX+XXXX+3312%22%3e%3cINPUT+type%3d%22hidden%22+name%3d%22MD%22+value%3d%222CCD7715-9E97-4F11-9FFF36E6584E3200%22%3e%3cINPUT+type%3d%22hidden%22+name%3d%22TermUrl%22+value%3d%22http%3a%2f%2f10.240.9.64%3a5000%2fpayment%2fenhanced%2fredirect%2f3d-secure%22%3e%3c%2fFORM%3e%3cSCRIPT+language%3d%22JavaScript%22%3edocument.form1.submit()%3b%3c%2fSCRIPT%3e%3c%2fBODY%3e%3c%2fHTML%3e"</span>,
  <span class="s2">"links"</span>: <span class="o">[</span> 
    <span class="o">{</span>
      <span class="s2">"rel"</span>: <span class="s2">"continue"</span>,
      <span class="s2">"href"</span>:<span class="s2">"https://api.na.bambora.com/v1/payments/2ccd7715-9e97-4f11-9fff36e6584e3200/continue"</span>,<span class="s2">"method"</span>:<span class="s2">"POST"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre>

<p>In the 302 response above, the &#39;merchant_data&#39; attribute value should be saved in the current users session.</p>

<p>The merchant’s process URL decodes the response redirect and displays the information in the customer’s web browser. 
This forwards the client to the VbV or SC, or SafeKey banking portal. On the bank portal, the customer enters their 
secure credit card pin number in the fields provided on the standard banking interface.</p>

<p>The bank forwards a response to the merchant’s TERM URL including the following variables:
- PaRes (Authentication Code)
- MD (Unique Payment ID)</p>

<p><strong>Step 2:</strong>  Process Transaction Auth Request</p>

<p>The merchant takes the data posted to the TERM URL and posts the PaRes and MD (merchant_data) values to our RESTful Payments API on its &#39;continue&#39; endpoint.</p>

<p>If the transaction fails VbV or SC, or SafeKey it is declined immediately with messageId=311 (3D Secure Failed). If the 
transaction passes, it is forwarded to the banks for processing. On completion, an approved or declined message is sent 
to the merchant processing script.</p>

<p>Upon success the term_url callback is called with following form encoded name/value params:</p>

<ul>
<li>(&#39;trnAmount&#39;, &#39;15.99&#39;)</li>
<li>(&#39;merchant_name&#39;, &#39;Your Merchant Inc.&#39;) </li>
<li>(&#39;password&#39;, &#39;&#39;)</li>
<li>(&#39;opResponse&#39;, &#39;&#39;) </li>
<li>(&#39;MD&#39;, &#39;C82A76AB-238D-48D8-BEEDCAAB19566C00&#39;) </li>
<li>(&#39;trnDatetime&#39;, &#39;2/23/2017 5:52:23 PM&#39;)</li>
<li>(&#39;PaRes&#39;, &#39;TEST_PaRes&#39;)</li>
<li>(&#39;termUrl&#39;, &#39;http://10.240.9.64:5000/payment/enhanced/redirect/3d-secure&#39;) </li>
<li>(&#39;trnEncCardNumber&#39;, &#39;XXXX XXXX XXXX 3312&#39;)</li>
<li>(&#39;PAC&#39;, &#39;TEST_PAC&#39;)</li>
<li>(&#39;retryAttempt&#39;, &#39;0&#39;)</li>
</ul>
<pre class="highlight shell"><code>Request

https://api.na.bambora.com/v1/payments/2ccd7715-9e97-4f11-9fff36e6584e3200/continue

<span class="o">{</span>
  <span class="s2">"payment_method"</span>: <span class="s2">"credit_card"</span>, 
  <span class="s2">"card_response"</span>: <span class="o">{</span>
    <span class="s2">"pa_res"</span>: <span class="s2">"TEST_PaRes"</span>
  <span class="o">}</span>
<span class="o">}</span>

Response

<span class="o">{</span>
  <span class="s2">"id"</span>: <span class="s2">"10000026"</span>,
  <span class="s2">"approved"</span>: <span class="s2">"1"</span>,
  <span class="s2">"message_id"</span>: <span class="s2">"1"</span>,
  <span class="s2">"message"</span>: <span class="s2">"Approved"</span>,
  <span class="s2">"auth_code"</span>: <span class="s2">"TEST"</span>,
  <span class="s2">"created"</span>: <span class="s2">"2017-02-23T17:26:26"</span>,
  <span class="s2">"order_number"</span>: <span class="s2">"MyOrderId000011223344"</span>,
  <span class="s2">"type"</span>: <span class="s2">"PA"</span>,
  <span class="s2">"payment_method"</span>: <span class="s2">"CC"</span>,
  <span class="s2">"amount"</span>: 15.99,
  <span class="s2">"custom"</span>: <span class="o">{</span>
    <span class="s2">"ref1"</span>: <span class="s2">""</span>,
    <span class="s2">"ref2"</span>: <span class="s2">""</span>,
    <span class="s2">"ref3"</span>: <span class="s2">""</span>,
    <span class="s2">"ref4"</span>: <span class="s2">""</span>,
    <span class="s2">"ref5"</span>: <span class="s2">""</span>
  <span class="o">}</span>,
  <span class="s2">"card"</span>: <span class="o">{</span>
    <span class="s2">"card_type"</span>: <span class="s2">"VI"</span>,
    <span class="s2">"last_four"</span>: <span class="s2">"3312"</span>,
    <span class="s2">"address_match"</span>: 0,
    <span class="s2">"postal_result"</span>: 0,
    <span class="s2">"cvd_result"</span>: 1,
    <span class="s2">"eci"</span>: 5
  <span class="o">}</span>,
  <span class="s2">"links"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"rel"</span>: <span class="s2">"complete"</span>,
      <span class="s2">"href"</span>: <span class="s2">"https://api.na.bambora.com/v1/payments/10000026/completions"</span>,
      <span class="s2">"method"</span>: <span class="s2">"POST"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre>

<h2 id="2-use-your-own-process">2. Use your own process</h2>

<p>Some large merchants complete the Verified by Visa (VbV), MasterCard SecureCode, or AMEX SafeKey certification to handle 
authentication on their own side. These merchants can use their existing VbV, SecureCode, or SafeKey authentication 
process, and send the results of the bank authentication to us with their standard transaction request. To do 
this, the merchant must integrate using a server-to-server type connection.</p>

<p>Note: This option must be enabled by us. Contact support if you want to use this method.</p>

<p>The VbV, SecureCode, or SafeKey bank authentication results must be sent with the transaction request using these three 
system variables:</p>
<div class='table-wrap'><table class='table'><thead><tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead><tbody><tr>
<td>xid</td>
<td>Include the 3D Secure transaction identifier (up to 20-digits).</td>
</tr>
<tr>
<td>eci</td>
<td>SecureECI is a 1-digit status code: 5 – authenticated; 6 – attempted, not completed.</td>
</tr>
<tr>
<td>cavv</td>
<td>Include the 40-character Cardholder Authentication Verification Value.</td>
</tr>
</tbody></table></div><pre class="highlight shell"><code>Definition
POST /v1/payments HTTP/1.1

Request
curl https://api.na.bambora.com/v1/payments <span class="se">\</span>
-H <span class="s2">"Authorization: Passcode MzAwMjAwNTc4OjRCYUQ4MkQ5MTk3YjRjYzRiNzBhMjIxOTExZUU5Zjcw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-d <span class="s1">'{
    "payment_method":"token",
    "order_number":"MyOrderId000011223344",
    "amount":15.99,
    "token":{
        "code":"gt7-0f2f20dd-777e-487e-b688-940b526172cd",
        "name":"John Doe",
        "3d_secure":{
            "enabled":true,
            "xid":"1368023",
            "cavv":"AAABAXlHEQAAAAGXAEcRAAAAAAA=",
            "eci":5
        }
    },
    "term_url": "https://my.merchantserver.com/redirect/3d-secure"
}'</span>

Response

<span class="o">{</span>
  <span class="s2">"id"</span>: <span class="s2">"10000026"</span>,
  <span class="s2">"approved"</span>: <span class="s2">"1"</span>,
  <span class="s2">"message_id"</span>: <span class="s2">"1"</span>,
  <span class="s2">"message"</span>: <span class="s2">"Approved"</span>,
  <span class="s2">"auth_code"</span>: <span class="s2">"TEST"</span>,
  <span class="s2">"created"</span>: <span class="s2">"2017-02-23T17:26:26"</span>,
  <span class="s2">"order_number"</span>: <span class="s2">"MyOrderId000011223344"</span>,
  <span class="s2">"type"</span>: <span class="s2">"PA"</span>,
  <span class="s2">"payment_method"</span>: <span class="s2">"CC"</span>,
  <span class="s2">"amount"</span>: 15.99,
  <span class="s2">"custom"</span>: <span class="o">{</span>
    <span class="s2">"ref1"</span>: <span class="s2">""</span>,
    <span class="s2">"ref2"</span>: <span class="s2">""</span>,
    <span class="s2">"ref3"</span>: <span class="s2">""</span>,
    <span class="s2">"ref4"</span>: <span class="s2">""</span>,
    <span class="s2">"ref5"</span>: <span class="s2">""</span>
  <span class="o">}</span>,
  <span class="s2">"card"</span>: <span class="o">{</span>
    <span class="s2">"card_type"</span>: <span class="s2">"VI"</span>,
    <span class="s2">"last_four"</span>: <span class="s2">"3312"</span>,
    <span class="s2">"address_match"</span>: 0,
    <span class="s2">"postal_result"</span>: 0,
    <span class="s2">"cvd_result"</span>: 1,
    <span class="s2">"eci"</span>: 5
  <span class="o">}</span>,
  <span class="s2">"links"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"rel"</span>: <span class="s2">"complete"</span>,
      <span class="s2">"href"</span>: <span class="s2">"https://api.na.bambora.com/v1/payments/10000026/completions"</span>,
      <span class="s2">"method"</span>: <span class="s2">"POST"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre>
 
          
          </div>
        </div>
      </div>
    </div>

    <footer>



                © <a href="http://www.bambora.com/en/en/payment-solutions/" target="_blank">2017 Bambora</a>

        <div class="links">
                <a href="http://www.bambora.com/en/en/payment-solutions/customer-service/faq/terms-and-conditions/" target="_blank">Terms & Conditions</a>
        </div>
        
        <div class="pull-right">
                <a href="https://github.com/bambora/" target="_blank">Github</a>
        </div>

</footer>

    <script src="../../../javascripts/template/tocbot_init_script-2dfca9f7.js" type="text/javascript"></script>

  </body>
</html>
